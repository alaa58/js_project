const productId = new URLSearchParams(window.location.search).get("id");
if (productId) {
  fetchProductDetails(productId);
} else {
  document.body.innerHTML = "<h1>Product not found!</h1>";
}
var pro = null;
async function fetchProductDetails(id) {
  await fetch(`https://fakestoreapi.in/api/products/${id}`)
    .then((response) => {
      if (!response.ok) throw new Error("Product not found");
      return response.json();
    })
    .then((data) => {
      // pro = JSON.stringify(data.product);
      // console.log(pro);
      let containCard = document.querySelector(".all");
      discountCN = data.product.discount || 0;
      discountCN *= 10;
      if (discountCN > 100) discountCN /= 10;
      containCard.innerHTML = `   <div class="images">
          <img src="${data.product.image}" />
        </div>
        <div class="contain">
          <h2 class="category">${data.product.category}</h2>
          <h2 class="lbl">${data.product.title}</h2>
          <p class="des">
            ${data.product.description}
          </p>
          <div class="prices">
            <div>
              <p class="price pric" >${data.product.price}$</p>
              <p><span class="discount dis">${discountCN}%</span></p>
            </div>
            <p class="afterdiscount">3</p>
          </div>

          <div class="cn_cart">
            <div class="count">
              <button type="button" onclick="decrease()" class="decreament">-</button>
              <button type="input" class="numbers">1</button>
              <button type="button" onclick="increase()" class="increament">+</button>
            </div>
<button onclick="addToCart('${pro}', ${id})" class="add_cart" type="button">
              <i class="fa-solid fa-cart-shopping"></i>
              <p>add to cart</p>
            </button>
          </div>
        </div>`;
      discount(data.product.price, discountCN);
    })
    .catch((error) => {
      console.error(error.message);
      document.body.innerHTML = "<h1>Error loading product details!</h1>";
    });
}
function decrease() {
  let count = document.querySelector(".numbers").innerHTML;
  count--;
  if (count < 0) count = 0;
  document.querySelector(".numbers").innerHTML = count;
  console.log(count);
}

function increase() {
  let count = document.querySelector(".numbers").innerHTML;
  count++;
  document.querySelector(".numbers").innerHTML = count;
  console.log(count);
}

function discount(pric, discoun) {
  let afterdiscoun = (discoun * pric) / 100;
  document.querySelector(".afterdiscount").innerHTML = afterdiscoun;
}

listcart = [];
function addToCart(produuct, id) {


  listcart[id] = produuct;
  // console.log(produuct);

  // produuct=JSON.parse(produuct);
  // console.log(produuct);
  // for (let i in produuct) {
  //   console.log(produuct[i]);
  // }
  // 
  // var expireDate = new Date();
  // expireDate.setDate(expireDate.getDate() + 1);
  // document.cookie = `listCartt=${JSON.stringify(
  //   listcart
  // )}; expires=${expireDate}; path=/ `;
  // console.log(document.cookie);

  // for (let i in listcart) {
  //   console.log(i);
  // }
}

function deletecookie(name) {
  var x = new Date();
  x.setDate(x.getDate() - 4);
  var value = "lk";
  document.cookie = `${name}=${value}; expires=${x}; path=/`;
}

// deletecookie("listCartt");
console.log(listcart);

function getCookie(name) {
  const cookies = document.cookie.split("; ");
  for (let cookie of cookies) {
    const [key, value] = cookie.split("=");
    if (key === name) {
      return value;
    }
  }
  return null;
}

console.log(getCookie["listCartt"]);

document.addEventListener("DOMContentLoaded", fetchProducts);
